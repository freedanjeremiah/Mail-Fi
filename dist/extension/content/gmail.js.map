{
  "version": 3,
  "sources": ["../../../extension/content/gmail.ts"],
  "sourcesContent": ["function ensurePanel() {\r\n  const id = \"mailfi-panel\";\r\n  let panel = document.getElementById(id) as HTMLIFrameElement | null;\r\n  if (!panel) {\r\n    panel = document.createElement(\"iframe\");\r\n    panel.id = id;\r\n    panel.src = chrome.runtime.getURL(\"ui/panel.html\");\r\n    panel.style.position = \"fixed\";\r\n    panel.style.top = \"64px\";\r\n    panel.style.right = \"16px\";\r\n    panel.style.width = \"380px\";\r\n    panel.style.height = \"520px\";\r\n    panel.style.border = \"0\";\r\n    panel.style.boxShadow = \"0 12px 32px rgba(0,0,0,.2)\";\r\n    panel.style.borderRadius = \"12px\";\r\n    panel.style.zIndex = \"2147483647\";\r\n    panel.style.display = \"none\";\r\n    document.body.appendChild(panel);\r\n  }\r\n  return panel;\r\n}\r\n\r\nfunction ensureFab(panel: HTMLIFrameElement) {\r\n  const id = \"mailfi-fab\";\r\n  let btn = document.getElementById(id) as HTMLButtonElement | null;\r\n  if (!btn) {\r\n    btn = document.createElement(\"button\");\r\n    btn.id = id;\r\n    btn.textContent = \"Pay with Avail\";\r\n    btn.className = \"mailfi-fab\";\r\n    btn.addEventListener(\"click\", () => {\r\n      panel.style.display = panel.style.display === \"none\" ? \"block\" : \"none\";\r\n    });\r\n    document.body.appendChild(btn);\r\n  }\r\n  return btn;\r\n}\r\n\r\nfunction togglePanel(panel: HTMLIFrameElement, recipient?: string) {\r\n  panel.style.display = panel.style.display === \"none\" ? \"block\" : \"none\";\r\n  // Optionally send recipient to panel iframe\r\n  if (recipient && panel.style.display === \"block\") {\r\n    panel.contentWindow?.postMessage({ type: \"SET_RECIPIENT\", recipient }, \"*\");\r\n  }\r\n}\r\n\r\nfunction injectComposeButton(composeWindow: Element, panel: HTMLIFrameElement) {\r\n  const toolbar = composeWindow.querySelector('[role=\"toolbar\"]');\r\n  console.log('[Mail-Fi] Toolbar found:', !!toolbar, composeWindow);\r\n  if (!toolbar) return;\r\n\r\n  const existingBtn = toolbar.querySelector(\".mailfi-compose-btn\");\r\n  if (existingBtn) return; // already injected\r\n\r\n  const btn = document.createElement(\"button\");\r\n  btn.className = \"mailfi-compose-btn\";\r\n  btn.setAttribute(\"aria-label\", \"Pay with Avail\");\r\n  btn.innerHTML = `\r\n    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n      <path d=\"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z\"/>\r\n    </svg>\r\n    <span style=\"margin-left: 4px;\">Pay with Avail</span>\r\n  `;\r\n\r\n  btn.addEventListener(\"click\", (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    // Try to extract recipient from compose \"To\" field\r\n    const toField = composeWindow.querySelector('input[name=\"to\"]') as HTMLInputElement;\r\n    const recipient = toField?.value || \"\";\r\n\r\n    togglePanel(panel, recipient);\r\n  });\r\n\r\n  // Insert before the last item (usually \"More options\" or trash)\r\n  const lastBtn = toolbar.querySelector('[role=\"button\"]:last-child');\r\n  if (lastBtn) {\r\n    toolbar.insertBefore(btn, lastBtn);\r\n  } else {\r\n    toolbar.appendChild(btn);\r\n  }\r\n}\r\n\r\nfunction observeComposeWindows(panel: HTMLIFrameElement) {\r\n  const observer = new MutationObserver(() => {\r\n    // Gmail compose windows have role=\"dialog\" or class containing \"M9\" (new compose) or inline reply divs\r\n    const composeWindows = document.querySelectorAll('[role=\"dialog\"], div[class*=\"M9\"]');\r\n    \r\n    console.log('[Mail-Fi] Found compose windows:', composeWindows.length);\r\n    \r\n    composeWindows.forEach((win) => {\r\n      injectComposeButton(win, panel);\r\n    });\r\n  });\r\n\r\n  observer.observe(document.body, { childList: true, subtree: true });\r\n\r\n  // Initial check for already-open compose windows\r\n  const existingComposeWindows = document.querySelectorAll('[role=\"dialog\"], div[class*=\"M9\"]');\r\n  console.log('[Mail-Fi] Initial compose windows:', existingComposeWindows.length);\r\n  existingComposeWindows.forEach((win) => {\r\n    injectComposeButton(win, panel);\r\n  });\r\n}\r\n\r\n(function init() {\r\n  if (!/mail\\.google\\.com/.test(location.host)) return;\r\n  const panel = ensurePanel();\r\n  ensureFab(panel);\r\n  observeComposeWindows(panel);\r\n  chrome.runtime.sendMessage({ type: \"PING\" }, () => {});\r\n})();\r\n"],
  "mappings": "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",
  "names": []
}
